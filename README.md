# AWS Terraform ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ã€AWSä¸Šã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’Terraformã§ç®¡ç†ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.
â”œâ”€â”€ modules/                # å…±é€šã®éƒ¨å“ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰
â”‚   â”œâ”€â”€ s3/                 # S3ä½œæˆãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ glue/               # Glueä½œæˆãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ kms/                # KMSä½œæˆãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ environments/           # å„ç’°å¢ƒã®è¨­å®š
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â”œâ”€â”€ main.tf         # module/s3 ãªã©ã‚’å‘¼ã³å‡ºã™
â”‚   â”‚   â”œâ”€â”€ variables.tf    # devç”¨ã®å¤‰æ•°ï¼ˆãƒã‚±ãƒƒãƒˆåãªã©ï¼‰
â”‚   â”‚   â””â”€â”€ backend.tf      # devç”¨ã®Stateä¿å­˜å…ˆ(S3)
â”‚   â”œâ”€â”€ stg/
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ backend.tf
â”‚   â””â”€â”€ prd/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ variables.tf
â”‚       â””â”€â”€ backend.tf
â”œâ”€â”€ .github/workflows/      # GitHub Actions
â”‚    â””â”€â”€ terraform.yml
â”œâ”€â”€ src/                   # ã‚³ãƒ¼ãƒ‰æœ¬ä½“
    â”œâ”€â”€ job1.py
    â””â”€â”€ tests/             # Pythonã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

```

## ğŸ“š æ§‹æˆè¦ç´ ã®èª¬æ˜

### modules/ - å…±é€šéƒ¨å“

ãƒªã‚½ãƒ¼ã‚¹ã®ä½œæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å®šç¾©ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚

- **s3/** - S3ãƒã‚±ãƒƒãƒˆä½œæˆç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **glue/** - AWS Glueä½œæˆç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **kms/** - KMSéµä½œæˆç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

### environments/ - ç’°å¢ƒåˆ¥è¨­å®š

å„ç’°å¢ƒï¼ˆdev/stg/prdï¼‰ã®è¨­å®šã¨ã€moduleså†…ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ãƒ¡ã‚¤ãƒ³è¨­å®šã‚’ç®¡ç†ã—ã¾ã™ã€‚

#### å„ç’°å¢ƒã®æ§‹æˆ

- **main.tf** - modulesã‚’å‘¼ã³å‡ºã—ã€ç’°å¢ƒå›ºæœ‰ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å®šç¾©
- **variables.tf** - ç’°å¢ƒã”ã¨ã®å¤‰æ•°å®šç¾©ï¼ˆãƒã‚±ãƒƒãƒˆåã‚„ã‚¿ã‚°ãªã©ï¼‰
- **backend.tf** - Terraformã®çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«(tfstate)ã®ä¿å­˜å…ˆè¨­å®š

### .github/workflows/ - CI/CD

GitHubActionsã«ã‚ˆã‚‹è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨­å®šã§ã™ã€‚

- **terraform.yml** - Terraformè¨ˆç”»ã¨é©ç”¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ææ¡ä»¶

- Terraform >= 1.0
- AWS CLIè¨­å®šæ¸ˆã¿
- é©åˆ‡ãªAWSèªè¨¼æƒ…å ±

### ãƒ‡ãƒ—ãƒ­ã‚¤

å„ç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼š

```bash
# devç’°å¢ƒ
cd environments/dev
terraform init
terraform plan
terraform apply

# stgç’°å¢ƒ
cd environments/stg
terraform init
terraform plan
terraform apply

# prdç’°å¢ƒ
cd environments/prd
terraform init
terraform plan
terraform apply
```

## ğŸ”§ ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

å„ç’°å¢ƒã®`variables.tf`ã§å¿…è¦ãªå¤‰æ•°ã‚’å®šç¾©ã—ã€`terraform.tfvars`ã§å€¤ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

```hcl
# environments/dev/terraform.tfvarsï¼ˆä¾‹ï¼‰
environment = "dev"
s3_bucket_name = "my-app-dev-bucket"
```

## ğŸ“ æ³¨æ„äº‹é …

- æœ¬ç•ªç’°å¢ƒï¼ˆprdï¼‰ã®å¤‰æ›´ã¯ååˆ†ãªãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµŒã¦ã‹ã‚‰é©ç”¨ã—ã¦ãã ã•ã„
- Terraformã®çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãŸã‚ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å³æ ¼ã«è¨­å®šã—ã¦ãã ã•ã„
- `.gitignore`ã«`*.tfvars`ï¼ˆç§˜å¯†æƒ…å ±ã‚’å«ã‚€ï¼‰ã¨`.terraform/`ã‚’è¿½åŠ ã—ã¦ãã ã•ã„

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€GitHubã®Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
